

# 管理平台（web）

## 连接设备

设备默认端口号80，用网线直连设备和电脑，修改电脑ip地址和设备在同一个网段

 在浏览器中访问http://ip地址来管理设备。

## 设备登录

打开浏览器输入http://ip:80登录平台，平台默认用户admin，默认密码admin

![14](./img_media/14.png)

## 大屏监控

![15](./img_media/15.png)

* 大屏监控支持1分屏，4分屏，9分屏三种方式
* 选择播放框后，点击对应设备即可播放

## 系统监控

![21](./img_media/21.png)

系统监控中记录了cpu ，网络， 内存， 磁盘的使用情况。

## 视频播放

点击播放按钮，跳转到视频播放界面。

云台控制只支持通过国标接入的球机。

![36](./img_media/36.png)

视频流播放地址，支持rtsp,rtmp, http-ts,http-flv,ws-flv等视频协议

![37](./img_media/37.png)

## onvif设备

IP地址填摄像头ip，端口一般默认80，用户名密码填摄像头用户名密码。

![45](./img_media/45.png)

点击下一步后会弹出该摄像头所有的视频流，选择需要的流添加名称，流应用名和流id

![46](./img_media/46.png)

添加成功后即可看到该设备列表。

![47](./img_media/47.png)

点击播放进入设备播放控制界面。

![48](./img_media/48.png)

## 国标设备

首先查看媒体配置

![43](./img_media/43.png)

### 大华摄像头

![大华](./img_media/大华.png)

* SIP服务器编号填写国标平台信息的（4国标编号）
* SIP服务器IP填写国标平台信息的（1流媒体平台ip地址）
* SIP域填写国标平台信息的（3国标域）
* SIP服务器端口填写国标平台信息的（2国标端口）
* 注册密码填写国标平台信息的（5国标密码）
* 设备编号填写20位国标设备ID，自行分配只要不重复即可（如不会可使用国标平台编号修改后5位，如34020000002000000002）
* 通道编号填写20位视频通道ID，自行分配同一个设备内不重复即可（如不会可使用默认编号例如：34020000001310000001）
* 其他值默认即可
* **勾选接入使能后保存方可生效**

### 海康摄像头

![海康](./img_media/海康.png)



- SIP服务器ID填写国标平台信息的（4国标编号）
- SIP服务器地址填写国标平台信息的（1流媒体平台ip地址）
- SIP服务器域填写国标平台信息的（3国标域）
- SIP服务器端口填写国标平台信息的（2国标端口）
- 注册密码，确认密码都填写国标平台信息的（5国标密码）
- SIP用户名/SIP用户认证ID填写20位国标设备ID，自行分配只要设备间不重复即可（如不会可使用国标平台编号修改后5位，如34020000002000000002）
- 视频通道编码ID填写20位视频通道ID，自行分配同一个设备内不重复即可（如不会可使用默认编号例如：34020000001310000001）
- 其他值默认即可
- **勾选启用后保存方可生效**

### 艾科威视摄像头

![艾科威视](./img_media/艾科威视.png)





- SIP服务器ID填写国标平台信息的（4国标编号）
- SIP服务器地址填写国标平台信息的（1流媒体平台ip地址）
- SIP服务器名称填写国标平台信息的（3国标域）
- SIP服务器端口填写国标平台信息的（2国标端口）
- SIP认证密码填写国标平台信息的（5国标密码）
- SIP用户名/SIP用户认证ID填写20位国标设备ID，自行分配只要设备间不重复即可（如不会可使用国标平台编号修改后5位，如34020000002000000002）
- 视频通道编码ID填写20位视频通道ID，自行分配同一个设备内不重复即可（如不会可使用默认编号例如：34020000001310000001）
- 其他值默认即可
- **登录接入服务器选择启用**

### 水星摄像头

![水星](./img_media/水星.png)

- SIP服务器ID填写国标平台信息的（4国标编号）
- SIP服务器地址填写国标平台信息的（1流媒体平台ip地址）
- SIP服务器域填写国标平台信息的（3国标域）
- SIP服务器端口填写国标平台信息的（2国标端口）
- 密码填写国标平台信息的（5国标密码）
- SIP用户名/SIP用户认证ID填写20位国标设备ID，自行分配只要设备间不重复即可（如不会可使用国标平台编号修改后5位，如34020000002000000002）
- 视频通道编码ID填写20位视频通道ID，自行分配同一个设备内不重复即可（如不会可使用默认编号例如：34020000001310000001）
- 其他值默认即可
- **勾选启用后保存方可生效**

## 拉流设备

拉流设备用于从摄像头或者第三方视频平台拉取RTSP视频流和RTMP视频流

点击添加代理来创建拉流代理

![20](./img_media/20.png)

* 名称：根据需求填写
* 流应用名： 根据需求填写(推荐英文加数字)
* 流Id： 根据需求填写(推荐英文加数字)
* 拉流地址： 支持rtsp和rtmp两种协议，直接输入需要拉流设备的rtsp或rtmp地址即可
* 创建完成后即可启用设备

* 以大华摄像头为例：

大华摄像头rtsp格式如下

```
    rtsp://[username]:[password]@[address]:[port]/cam/realmonitor?channel=[id]&subtype=[type]
    rtsp:// => 协议格式头
    username => 用户名，例如：admin
    password => 密码，例如：123456
    address => IPC设备的网络地址，例如：192.168.1.65
    port => IPC设备的RTSP输出端口，默认为554，若为默认可不填写
    id => 通道号，起始为1。例如通道2，则为channel=2。
    type => 码流类型，主码流为0（即subtype=0），辅码流为1（即subtype=1）。
```

如果我们要拉取的设备ip是192.168.1.65用户名密码为admin/123456，则在拉流地址中输入rtsp://admin:123456@192.168.1.65:554/cam/realmonitor?channel=1&subtype=0即可拉取主码流

## 推流设备

推流设备用用于展示第三方摄像头或者流媒体平台推过来的RTSP视频流或者RTMP视频流

推流时需要携带推流密码（推流密码在媒体设置中查看）鉴权的签名sign，使用形式为后缀加上?sign=推流密码

```
rtsp://192.168.0.250/test/live?sign=123456
```

**我们使用ffmpeg来模拟推流**

```
ffmpeg -re -stream_loop -1 -i test.mp4 -framerate 25 -r 25 -vcodec copy -acodec copy -preset ultrafast -f rtsp -rtsp_transport tcp rtsp://192.168.0.250/test/live?sign=123456
```

上面我们是将test.mp4以rtsp协议的方式推送到我们的流媒体服务器上，这是我们的管理平台推流设备中就可以看到app为test，流id为live的设备

![30](./img_media/30.png)

**我们再使用OBS来推流**

![34](./img_media/34.png)

test是流应用名，live是流id，sign是推流密码

效果和上面的ffmpeg推流一样

## 对外推流

可以以RTSP或者RTMP协议推流到第三方流媒体平台，以及各种直播平台。

首先选择一个我们流媒体中的视频流地址选择rtsp活rtmp拷贝

![23](./img_media/23.png)

在对外推流中点击添加，将我们复制的地址拷贝到源地址，推流方式要和源地址一致，如果是推rtsp流则选择rtsp，推流地址填写目标地址

![24](./img_media/24.png)





## 系统设置

### 媒体配置

国标设备接入主要是需要在设备上配置28181上级也就是流媒体的信息，信息一致才可以注册成功。

点击系统设置-》媒体配置，如下图：

![9](./img_media/9.png)

- **IP: 流媒体的ip地址，用于视频流连接和返回，如果使用有线连接就用有线的ip地址，用wifi连接就用wifi的ip地址。**

- 推流密码：如果为空则不需要密码否则第三方推流到平台需要用到这个密码。

- HTTP端口-RTSMPS端口：不同协议视频流端口号

- 国标端口：对应摄像头设备里面填写的SIP服务器端口。

- 国标域：对应设备里面的SIP服务器域。

- 国标编号：SIP服务器ID。

- 国标注册密码：国标注册密码。

- 国标收流端口：一串连续的端口号用于国标收流，最少确保36个端口。

- 国标无人观看自动关闭：开启：点播后播放，无人观看自动断流。关闭：无需点播自动播放，视频流一直存在。

  



### 网络设置

![17](./img_media/17.png)



* dhcp: 关闭则使用手动配置ip信息，开启自动获取ip信息。
* 同步流媒体配置：开启会将当前ip地址自动更新到流媒体配置中。

### wifi设置

![44](./img_media/44.png)

### 时间设置

![](./img_media/19.png)

* 推荐开启ntp自动校时服务，可以确保系统时间正确。

### 系统更新

在系统设置-》系统更新页面，上传更新包

![](./img_media/41.png)

点击上传，选择更新包，上传成功后出现更新系统按钮，点击更新按钮更新系统。

![](./img_media/42.png)

更新完成后重启后生效





# 扩展

## 注意事项

* 国标设备的设备ID不能重复
* 拉流设备，推流设备同一个流应用名（app）下面的流Id不能重复

## 国标ID命名规范

国标ID由中心编码（8位）、行业编码（2位）、类型编码（3位）和序号（7位）四个码段共20位十进制数字字符构成，即系统编码 =中心编码 + 行业编码 + 类型编码 + 序号。
国标ID命名的详细说明见**详细编码规则**。其中：

- 中心编码：指用户或设备所归属的监控中心的编码，按照监控中心所在地的行政区划代码确定，当不是基层单位时空余位为0。行政区划代码采用GB/T 2260-2007规定的行政区划代码表示。
- 行业编码：是指用户或设备所归属的行业，行业编码对照详见**行业编码规范**。
- 类型编码指定了设备或用户的具体类型，其中的前端设备包含公安系统和非公安系统的前端设备，终端用户包含公安系统和非公安系统的终端用户。

![](./img_media/10.png)



![水星](./img_media/11.png)

![水星](./img_media/12.png)

#### 行业编码规范

![水星](./img_media/13.png)